# R script to download selected samples
# Copy code and run on a local machine to initiate download

library("rhdf5")    # can be installed using Bioconductor

destination_file = "human_matrix_v10.h5"
extracted_expression_file = "MCF10_expression_matrix.tsv"
url = "https://s3.amazonaws.com/mssm-seq-matrix/human_matrix_v10.h5"

# Check if gene expression file was already downloaded, if not in current directory download file form repository
if(!file.exists(destination_file)){
    print("Downloading compressed gene expression matrix.")
    download.file(url, destination_file, quiet = FALSE, mode = 'wb')
}

# Selected samples to be extracted
samp = c("GSM830454","GSM830453","GSM830455","GSM830456","GSM830457","GSM1446201","GSM1511877","GSM1921816","GSM1921813","GSM1511880","GSM2157789","GSM1434985","GSM2157780","GSM1446218","GSM1921817","GSM1921811","GSM1921812","GSM1290215","GSM1874955","GSM1446211","GSM1446212","GSM1446202","GSM1511873","GSM1921818","GSM1921814","GSM1446214","GSM2157782","GSM1446215","GSM2157778","GSM2157779","GSM1290217",
"GSM1434983","GSM1446199","GSM1446200","GSM1874957","GSM1874953","GSM1511879","GSM1290219","GSM1874956","GSM1446210","GSM2157784","GSM1511875","GSM2157785","GSM2157783","GSM1290216","GSM1434984","GSM1290220","GSM1511878","GSM1446207","GSM1434982","GSM1446205","GSM1446217","GSM1446206","GSM2157788","GSM1446198","GSM1446197","GSM1446203","GSM1446208","GSM1874952","GSM1446209","GSM1420579",
"GSM2157786","GSM1446204","GSM1511876","GSM2157781","GSM2157787","GSM1446213","GSM1511874","GSM1709525","GSM2123902","GSM1709578","GSM1709559","GSM1709575","GSM1709589","GSM2123913","GSM1709566","GSM1919091","GSM1709588","GSM1919093","GSM1919103","GSM1709516","GSM1919096","GSM1709571","GSM1919100","GSM1829628","GSM1709551","GSM2123904","GSM2295992","GSM1709549","GSM1709568","GSM2295986",
"GSM2295988","GSM1709563","GSM1919092","GSM1709558","GSM2123903","GSM1709552","GSM1709584","GSM1709565","GSM1919094","GSM1709538","GSM2123911","GSM1919102","GSM1709530","GSM1709524","GSM1709585","GSM1709569","GSM1709539","GSM2123909","GSM2123915","GSM2295987","GSM1709555","GSM2123907","GSM1919090","GSM1919095","GSM1709517","GSM1709540","GSM2295985","GSM2123908","GSM2123939","GSM2123945",
"GSM2295995","GSM1709562","GSM1709564","GSM1709572","GSM1709547","GSM2295990","GSM2123905","GSM1709519","GSM2295993","GSM1709520","GSM1709567","GSM1919099","GSM1709518","GSM2123898","GSM1709577","GSM1709535","GSM1709573","GSM1709580","GSM1709570","GSM1709546","GSM2123910","GSM1709544","GSM2123899","GSM1709532","GSM2123938","GSM1709541","GSM1709561","GSM1709553","GSM2295997","GSM1709534",
"GSM2123936","GSM1709521","GSM2295994","GSM1709542","GSM1709522","GSM2123916","GSM2123914","GSM2123941","GSM1709560","GSM1709583","GSM1709515","GSM1709586","GSM2295989","GSM1709528","GSM1919088","GSM1709554","GSM1709523","GSM2123937","GSM1919097","GSM1709557","GSM1919098","GSM1709550","GSM1709527","GSM1709536","GSM2123901","GSM2123940","GSM1709529","GSM2123943","GSM2123912","GSM1709587",
"GSM2123896","GSM1709581","GSM1709531","GSM1709543","GSM1709548","GSM2123900","GSM1709556","GSM1709574","GSM1709533","GSM2123906","GSM2123897","GSM1919101","GSM2295991","GSM1919089","GSM1709526","GSM1709576","GSM1709537","GSM2295996","GSM2123895","GSM1709579","GSM1709545","GSM1290218","GSM1446195","GSM1446196","GSM1446216","GSM1874954","GSM1921815","GSM1446848","GSM1446849","GSM1446858",
"GSM1446859","GSM1446860","GSM1446861","GSM2218826","GSM2218827","GSM2218828","GSM2545225","GSM2545226","GSM2545227","GSM2545228","GSM2218829","GSM2218830","GSM2218831","GSM2218832","GSM2218833","GSM2218834","GSM2773021","GSM2773022","GSM2773023","GSM1620416","GSM1620417","GSM1620420","GSM1620424","GSM1620425","GSM1620426","GSM1620427","GSM1620431","GSM1620433","GSM1620434","GSM1620435",
"GSM1620437","GSM1620439","GSM1620440","GSM1620442","GSM1620443","GSM1620445","GSM1620447","GSM1620449","GSM1620450","GSM1620452","GSM1620453","GSM1620454","GSM1620456","GSM1620457","GSM1620458","GSM1620460","GSM1620461","GSM1620463","GSM1620464","GSM1620465","GSM1620466","GSM1620467","GSM1620468","GSM1620470","GSM1620471","GSM1620472","GSM1620473","GSM1620475","GSM1620477","GSM1620479",
"GSM1620482","GSM1620483","GSM1620484","GSM1620494","GSM1620498","GSM1620501","GSM1620502","GSM1620503","GSM1620513","GSM1620514","GSM1620515","GSM1620517","GSM1620518","GSM1620519","GSM1620524","GSM1620528","GSM1620529","GSM1620530","GSM1620531","GSM1620535","GSM1620551","GSM1620553","GSM1620554","GSM1620555","GSM1620558","GSM1620560","GSM1620562","GSM1620563","GSM1620567","GSM1620569",
"GSM1620570","GSM1620571","GSM1620572","GSM1620574","GSM1620576","GSM1620577","GSM1620581","GSM1620582","GSM1620585","GSM1620586","GSM1620587","GSM1620589","GSM1620592","GSM1620593","GSM1620595","GSM1620596","GSM1620597","GSM1620599","GSM1620602","GSM1620603","GSM1620606","GSM1620607","GSM1620613","GSM1620621","GSM1620623","GSM1620624","GSM1620626","GSM1620629","GSM1620631","GSM1620635",
"GSM1620636","GSM1620637","GSM1620638","GSM1620640","GSM1620642","GSM1620643","GSM1620645","GSM1620646","GSM1620647","GSM1620649","GSM1620650","GSM1620651","GSM1620654","GSM1620656","GSM1620657","GSM1620658","GSM1620659","GSM1620660","GSM1620661","GSM1620662","GSM1620665","GSM1620668","GSM1620669","GSM1620670","GSM1620675","GSM1620679","GSM1620681","GSM1620683","GSM1620684","GSM1620688",
"GSM1620690","GSM1620691","GSM1620692","GSM1620694","GSM1620698","GSM1620704","GSM1620705","GSM1620707","GSM1620713","GSM1620716","GSM2286710","GSM2286711","GSM2286712","GSM2286713","GSM2286714","GSM2286715","GSM2286716","GSM2286717","GSM2286718","GSM2286719","GSM2286720","GSM2286721","GSM2286722","GSM2286723","GSM2286724","GSM2286725","GSM2286726","GSM2286727","GSM2359781","GSM2359782",
"GSM2359783","GSM2359784","GSM2359785","GSM2359786","GSM2359787","GSM2359788","GSM2359789","GSM2360153","GSM2360154","GSM2360155","GSM2360156","GSM2360157","GSM2360158","GSM2360159","GSM2360160","GSM2360161","GSM2360162","GSM2360163","GSM2360164","GSM2360165","GSM2360166","GSM2911343","GSM2911344","GSM2911345","GSM2911346","GSM2911347","GSM2718332","GSM2718333","GSM2718334","GSM2718335",
"GSM2718336","GSM2718337","GSM2718338","GSM2718339","GSM1847015","GSM1847016","GSM1847017","GSM2593351","GSM2593352","GSM2593353","GSM2593354","GSM2593355","GSM2593356","GSM2593357","GSM2593358","GSM2593359","GSM2593360","GSM2593361","GSM2593362","GSM2593363","GSM2593364","GSM2593365","GSM3184667","GSM3184668","GSM3184669","GSM3184670","GSM3184671","GSM3184672","GSM3184673","GSM3184674",
"GSM2862176","GSM2862177","GSM3163163","GSM3163164","GSM3163165","GSM3163166","GSM3163167","GSM3163168","GSM3163169","GSM3163170","GSM3163171","GSM3108139","GSM3108140","GSM3108141","GSM3108142","GSM3415919","GSM3415920","GSM3454786","GSM3454787","GSM3454788","GSM3454789","GSM3454790","GSM3454791","GSM3454792","GSM3454793","GSM3454794","GSM3454795","GSM3454796","GSM3454797","GSM3454798",
"GSM3454799","GSM3454800","GSM3454801","GSM3454802","GSM3454803","GSM3454804","GSM3454805","GSM3454806","GSM3454807","GSM3454808","GSM3454809","GSM3397168","GSM3397169","GSM3397170","GSM3397171","GSM3397172","GSM3397173","GSM3397174","GSM3397175","GSM3397176","GSM3397177","GSM3397178","GSM3397179","GSM3397180","GSM3397181","GSM3397182","GSM3397183","GSM3397184","GSM3397185","GSM3397186",
"GSM3397187","GSM3397188","GSM3397189","GSM3397190","GSM3397191","GSM2739773","GSM2739774","GSM2739775","GSM2739776","GSM2739777","GSM2739778","GSM2739779","GSM2739780","GSM3567580","GSM3567581","GSM3567582","GSM3567583","GSM2442949","GSM2442950","GSM2461683","GSM2461684","GSM2461685","GSM2461686","GSM2461687","GSM2461688","GSM3164292","GSM3164293","GSM3164294","GSM3164295","GSM3164296",
"GSM3164297","GSM3164298","GSM3164299","GSM3164300","GSM3164301","GSM3164302","GSM3164303","GSM3359097","GSM3359098","GSM3359099","GSM3359100","GSM3359101","GSM3359102","GSM3359103","GSM3359104","GSM3359105","GSM3359106","GSM3359107","GSM3359108","GSM3396116","GSM3396117","GSM3396118","GSM3396119","GSM3396120","GSM3396121","GSM3396122","GSM3396123","GSM3396124","GSM3396125","GSM3396126",
"GSM3396127","GSM3396128","GSM3396129","GSM3396130","GSM3396131","GSM3396132","GSM3396133","GSM3139685","GSM3147293","GSM3147294","GSM3147295","GSM3147296","GSM1808935","GSM1808936","GSM1808937","GSM1808938","GSM3466342","GSM3466343","GSM3466344","GSM3466345","GSM4160268","GSM4160269","GSM4160270","GSM4160271","GSM4160272","GSM4160273","GSM4160274","GSM4160275","GSM4079350","GSM4079351",
"GSM4079352","GSM4079353","GSM4079354","GSM4079355","GSM4079356","GSM4079357","GSM4079358","GSM4079359","GSM4079360","GSM4079361","GSM4079362","GSM4079363","GSM4079364","GSM4079365","GSM4079366","GSM4079367","GSM2990880","GSM2990881","GSM2990882","GSM2990879","GSM3302715","GSM3302716","GSM3302717","GSM3302718","GSM3302720","GSM3556954","GSM3556955","GSM3556956","GSM3556957","GSM3556958",
"GSM3556959","GSM3556960","GSM3556961","GSM3556962","GSM3556963","GSM3556964","GSM3556965","GSM3556966","GSM3556967","GSM3556968","GSM3556969","GSM3556970","GSM3556971","GSM3556972","GSM3556973","GSM3556974","GSM3556975","GSM3556976","GSM3556977","GSM3660722","GSM3660723","GSM3660724","GSM3660725","GSM3660726","GSM3660727","GSM3660728","GSM3660729","GSM3660730","GSM4198783","GSM4198784",
"GSM4198785","GSM4198786","GSM4198787","GSM4198788","GSM4198789","GSM4198790","GSM4198791","GSM4198792","GSM4198793","GSM4198794","GSM4198795","GSM4198796","GSM4198797","GSM4198798","GSM4198799","GSM4198800","GSM4198801","GSM4198802","GSM4205110","GSM4205111","GSM4205112","GSM4205113","GSM4205114","GSM4205115","GSM4219522","GSM4219523","GSM4219524","GSM4219525","GSM4219526","GSM4219527",
"GSM4219528","GSM4219529","GSM4219530","GSM4219531","GSM4219532","GSM4219533","GSM4219534","GSM4219535","GSM4219536","GSM4433435","GSM4433436","GSM4433437","GSM4433438","GSM4433439","GSM4433440","GSM4433441","GSM4433442","GSM4433443","GSM4441661","GSM4441662","GSM4441663","GSM4441664","GSM4441665","GSM4441666","GSM4441667","GSM4441668","GSM4441669","GSM4441670","GSM4498080","GSM4498082",
"GSM4498083","GSM4498084","GSM4498085","GSM4498086","GSM4498087","GSM4498088","GSM4498089","GSM4498090","GSM4498091","GSM4498092","GSM4498093","GSM4498094","GSM4498095","GSM4498096","GSM4498097","GSM4519427","GSM4519428","GSM4519429","GSM4519430","GSM4519431","GSM4519432","GSM4519433","GSM4519434","GSM4667014","GSM4667015","GSM4667016","GSM4667017","GSM4667018","GSM4667019","GSM4307237",
"GSM4307238","GSM4307239","GSM4307240","GSM4307241","GSM4307242","GSM4307243","GSM4307244","GSM4307245","GSM4307246","GSM4307247","GSM4307248","GSM4307249","GSM4307250","GSM4307251","GSM4307252","GSM4307253","GSM4307254","GSM4307255","GSM4307256","GSM4307257","GSM4307258","GSM4307259","GSM4307260","GSM4307261","GSM4307262","GSM4337723","GSM4337724","GSM4337725","GSM4337726","GSM4337727",
"GSM4337728","GSM4337729","GSM4337730","GSM4337731","GSM4337732","GSM4337733","GSM4337734","GSM4337735","GSM4337736","GSM4337737","GSM4337738","GSM4473386","GSM4473387","GSM4473388","GSM4512105","GSM4512106","GSM4512107","GSM4512108","GSM4512109","GSM4512110","GSM4512111","GSM4663673","GSM4663674","GSM4663675","GSM4663676","GSM4663677","GSM4663678","GSM4663679","GSM4663680","GSM4663681",
"GSM4663682","GSM4663683","GSM4663684","GSM4669217","GSM4669218","GSM4669219","GSM4669220","GSM4096213","GSM4096214","GSM4096216","GSM4096217","GSM4096218","GSM4096221","GSM4096222","GSM4096223","GSM4096224","GSM4096225","GSM4096226","GSM4096230","GSM4158384","GSM4158385","GSM4158386","GSM4158387","GSM4158388","GSM4158389","GSM4158390","GSM4158391","GSM4158392","GSM4158393","GSM4376633",
"GSM4376637","GSM4376638","GSM4443417","GSM4443418","GSM4443420","GSM4443421","GSM4443423","GSM4443425","GSM4443458","GSM4443459","GSM4443460","GSM4443462","GSM4443463","GSM4443464","GSM4443465","GSM4443466","GSM4443468","GSM4443469","GSM4443471","GSM4443472","GSM4443474","GSM4443475","GSM4443476","GSM4443478","GSM4443479","GSM4443481","GSM5024193","GSM5024194","GSM5024195","GSM5024197",
"GSM5024201","GSM5024205","GSM5024206","GSM5024210","GSM5100575","GSM5100576","GSM5100577","GSM5100579","GSM5100580","GSM5100581","GSM5100582","GSM5171661","GSM5171662","GSM5171663","GSM5171664","GSM5171666","GSM5171667","GSM5171668","GSM5171669","GSM5171670","GSM5171671","GSM5171672","GSM5171673","GSM5171674","GSM5171675","GSM5171676","GSM5171677","GSM5171678","GSM5268960","GSM5268961",
"GSM5268962","GSM5268963","GSM5268964","GSM5268965","GSM5268966","GSM5268967","GSM5268968","GSM5268969","GSM5268970","GSM5268972","GSM5268973","GSM5268974","GSM5268975","GSM5268976","GSM5268977","GSM5268978","GSM5268979","GSM5268980","GSM5268981","GSM5268982","GSM5268983","GSM5268984","GSM5268985","GSM5268986","GSM5268987","GSM5268988","GSM5268989","GSM5268990","")

# Retrieve information from compressed data
samples = h5read(destination_file, "meta/samples/geo_accession")
genes = h5read(destination_file, "meta/genes/genes")

# Identify columns to be extracted
sample_locations = which(samples %in% samp)

# extract gene expression from compressed data
expression = t(h5read(destination_file, "data/expression", index=list(sample_locations, 1:length(genes))))
H5close()
rownames(expression) = genes
colnames(expression) = samples[sample_locations]

# Print file
write.table(expression, file=extracted_expression_file, sep="\t", quote=FALSE, col.names=NA)
print(paste0("Expression file was created at ", getwd(), "/", extracted_expression_file))

