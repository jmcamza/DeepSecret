# R script to download selected samples
# Copy code and run on a local machine to initiate download

library("rhdf5")    # can be installed using Bioconductor

destination_file = "human_matrix_v10.h5"
extracted_expression_file = "Hepatocyte_expression_matrix.tsv"
url = "https://s3.amazonaws.com/mssm-seq-matrix/human_matrix_v10.h5"

# Check if gene expression file was already downloaded, if not in current directory download file form repository
if(!file.exists(destination_file)){
    print("Downloading compressed gene expression matrix.")
    download.file(url, destination_file, quiet = FALSE, mode = 'wb')
}

# Selected samples to be extracted
samp = c("GSM1076107","GSM1646733","GSM1646725","GSM1646726","GSM1646728","GSM1646686","GSM1646702","GSM1306652","GSM1646729","GSM1646701","GSM1646697","GSM1646723","GSM1646709","GSM1646704","GSM1646698","GSM1646713","GSM1646691","GSM1377537","GSM1646712","GSM1646700","GSM1646699","GSM1306655","GSM1646684","GSM1646689","GSM1646707","GSM1646715","GSM1646688","GSM1306657","GSM1646731","GSM1646683","GSM1646732",
"GSM1646679","GSM1646681","GSM1646714","GSM1646694","GSM1646721","GSM2228738","GSM1646716","GSM1646680","GSM1306654","GSM1646696","GSM1306656","GSM1646730","GSM1646720","GSM1646710","GSM1646692","GSM1377536","GSM1646708","GSM1646685","GSM1646687","GSM1646727","GSM1646719","GSM2228740","GSM1646705","GSM1646695","GSM1646722","GSM1646693","GSM1646718","GSM2228739","GSM1646690","GSM1646706",
"GSM1646717","GSM1646711","GSM1306653","GSM1886915","GSM1657150","GSM1886914","GSM1707675","GSM1886913","GSM1657147","GSM1657148","GSM1707674","GSM1657149","GSM1646682","GSM1646724","GSM1646703","GSM2344261","GSM2071513","GSM2071512","GSM2072603","GSM2072604","GSM2344260","GSM1974235","GSM1974236","GSM2262407","GSM2584723","GSM2584724","GSM2584725","GSM2584726","GSM2610525","GSM2610526",
"GSM2753372","GSM2753373","GSM2753374","GSM2753375","GSM2204135","GSM2204136","GSM2691353","GSM2691354","GSM2691355","GSM2691356","GSM2691357","GSM2691358","GSM2691359","GSM2691360","GSM2753376","GSM2753377","GSM2753378","GSM2753379","GSM2747455","GSM2747456","GSM2747457","GSM2747458","GSM2747459","GSM2747460","GSM2747461","GSM2747462","GSM2747463","GSM2747464","GSM2747465","GSM2747466",
"GSM2747467","GSM2747468","GSM2747469","GSM2747470","GSM2747471","GSM2747472","GSM2747473","GSM2747474","GSM2747475","GSM2747476","GSM2747477","GSM2747478","GSM2747479","GSM2747480","GSM2747481","GSM2747482","GSM2747483","GSM2747484","GSM2747485","GSM2747486","GSM2747487","GSM2747488","GSM2747489","GSM2747490","GSM3036700","GSM3036701","GSM3036702","GSM3036703","GSM3036704","GSM3036705",
"GSM2680338","GSM2680339","GSM2680340","GSM2680341","GSM2680342","GSM2680343","GSM2715279","GSM1974233","GSM1974234","GSM1974237","GSM1974238","GSM1974239","GSM1974240","GSM1974241","GSM1974242","GSM1974245","GSM1974246","GSM1974247","GSM1974248","GSM3130444","GSM3130445","GSM3130446","GSM3130447","GSM3130448","GSM3130449","GSM3130450","GSM3130451","GSM3130452","GSM3130453","GSM3130454",
"GSM3130455","GSM2819677","GSM2819678","GSM2819679","GSM2819680","GSM2819681","GSM2819682","GSM2819683","GSM2819684","GSM2819685","GSM2819686","GSM2819687","GSM2819688","GSM2819689","GSM2819690","GSM2819691","GSM2819692","GSM2819693","GSM2819694","GSM2819695","GSM2819696","GSM2819697","GSM2819698","GSM2819699","GSM2819700","GSM2819701","GSM2819702","GSM2819703","GSM2819704","GSM2819705",
"GSM2819706","GSM2819707","GSM2819708","GSM2819709","GSM2819710","GSM2819711","GSM2819712","GSM2819713","GSM2819714","GSM2819715","GSM2819716","GSM2819717","GSM2819718","GSM2819719","GSM2819720","GSM2819721","GSM2819722","GSM2819723","GSM2819724","GSM2819725","GSM2819726","GSM2819727","GSM2819728","GSM2819729","GSM2819730","GSM2819731","GSM2819732","GSM2819733","GSM3090157","GSM3090158",
"GSM3090159","GSM3090160","GSM3090161","GSM3090162","GSM3090163","GSM3090164","GSM3090165","GSM3090166","GSM3090167","GSM3090168","GSM3090169","GSM3090170","GSM3563537","GSM3563538","GSM3563539","GSM3563540","GSM3563541","GSM3563542","GSM3563543","GSM3563544","GSM3396303","GSM3396304","GSM3396305","GSM3396306","GSM3396307","GSM3396308","GSM3396309","GSM3396310","GSM3396311","GSM3396312",
"GSM3396313","GSM3396314","GSM3396315","GSM3396317","GSM3396319","GSM3396321","GSM3396322","GSM3396323","GSM3396324","GSM3396325","GSM3396326","GSM3396327","GSM3396328","GSM2893923","GSM2893924","GSM2893935","GSM2893936","GSM2893937","GSM2893938","GSM2893939","GSM2893940","GSM2893943","GSM2893944","GSM2893945","GSM2893947","GSM2893949","GSM2893951","GSM2893952","GSM2893953","GSM2893955",
"GSM2893956","GSM2893957","GSM2893959","GSM2893961","GSM2893963","GSM3146358","GSM3146359","GSM3146361","GSM3146364","GSM3535859","GSM3535860","GSM3629856","GSM3629857","GSM3629858","GSM3629859","GSM3629860","GSM3629861","GSM3629862","GSM3764820","GSM3764821","GSM3764822","GSM3764823","GSM3067786","GSM3067787","GSM3067788","GSM3067794","GSM3067795","GSM3067796","GSM3067797","GSM3067798",
"GSM3067804","GSM3067807","GSM3067808","GSM3520209","GSM3520210","GSM3520211","GSM3520212","GSM3520213","GSM3520214","GSM3520215","GSM3520216","GSM3520217","GSM3520218","GSM3520219","GSM3520220","GSM3520221","GSM3520222","GSM3520223","GSM3520224","GSM3520225","GSM3520226","GSM3520227","GSM3520228","GSM3520229","GSM3520230","GSM3520231","GSM3520232","GSM3520233","GSM4026535","GSM4026543",
"GSM4026544","GSM2333742","GSM2333743","GSM2333744","GSM2333750","GSM2333751","GSM2333752","GSM2333753","GSM2333754","GSM2333755","GSM2333756","GSM2333757","GSM2333764","GSM2333765","GSM3442824","GSM3442825","GSM3442826","GSM3442827","GSM3442828","GSM3520175","GSM3520176","GSM3520177","GSM3520178","GSM3520179","GSM3520180","GSM3520181","GSM3520182","GSM3520183","GSM3520184","GSM3520185",
"GSM3520186","GSM3520187","GSM3520188","GSM3520189","GSM3520190","GSM3520191","GSM3520192","GSM3520193","GSM3520194","GSM3520195","GSM3520196","GSM3520197","GSM3520198","GSM3520199","GSM3520200","GSM3520201","GSM3520202","GSM3520203","GSM3520204","GSM3520205","GSM3520206","GSM3520207","GSM3520208","GSM3325846","GSM3325848","GSM3325850","GSM3325852","GSM3325854","GSM3325856","GSM4046808",
"GSM4046809","GSM4046810","GSM4046811","GSM3409471","GSM3409472","GSM3504401","GSM3504402","GSM3504403","GSM3504404","GSM3505552","GSM3505571","GSM3505572","GSM3946327","GSM3946328","GSM3946329","GSM3946330","GSM3946331","GSM3946332","GSM3946333","GSM4148410","GSM4148411","GSM4148412","GSM4148413","GSM4148414","GSM4148415","GSM4148416","GSM4148417","GSM4148418","GSM4148419","GSM4148420",
"GSM4148421","GSM4148422","GSM4148423","GSM4148424","GSM4148425","GSM4148426","GSM4148427","GSM4148428","GSM4148429","GSM4148430","GSM4148431","GSM4148432","GSM4148433","GSM4148434","GSM4148435","GSM4148436","GSM4148437","GSM4148438","GSM4148439","GSM4182814","GSM4182826","GSM4182838","GSM4182850","GSM4182862","GSM4182874","GSM4226620","GSM4226621","GSM4226623","GSM4226624","GSM4226625",
"GSM4226626","GSM4226627","GSM4226628","GSM4226629","GSM4226630","GSM4291727","GSM4291728","GSM4291729","GSM4291730","GSM4291731","GSM4291732","GSM4291733","GSM4291734","GSM4291735","GSM4562455","GSM4562456","GSM4562457","GSM4562458","GSM4562459","GSM4562460","GSM4562461","GSM4562462","GSM4562463","GSM4562464","GSM4562465","GSM4562466","GSM4562467","GSM4562468","GSM4562469","GSM4562470",
"GSM4562471","GSM4562472","GSM4562473","GSM4562474","GSM4562475","GSM4562476","GSM4562477","GSM4562478","GSM4562479","GSM4562480","GSM4562481","GSM4562482","GSM4562483","GSM4562484","GSM4562485","GSM4562486","GSM4562487","GSM3518767","GSM3518768","GSM3518769","GSM3518770","GSM3518771","GSM3518772","GSM3732579","GSM3732580","GSM3732581","GSM3732582","GSM3732583","GSM3732584","GSM4097456",
"GSM4097457","GSM4097458","GSM4097459","GSM4097460","GSM4097461","GSM4174894","GSM4174895","GSM4174896","GSM4850499","GSM4850500","GSM4850501","GSM4850502","GSM4850503","GSM4850504","GSM3520234","GSM4008762","GSM4008763","GSM4008764","GSM4008765","GSM4008766","GSM4008767","GSM4008768","GSM4008769","GSM4008770","GSM4008771","GSM4008772","GSM4008773","GSM4008774","GSM4008775","GSM4008776",
"GSM4008777","GSM4008778","GSM4008779","GSM4008780","GSM4008781","GSM4008782","GSM4117772","GSM4117773","GSM4117774","GSM4451892","GSM4451893","GSM4451894","GSM4451895","GSM4451896","GSM4451897","GSM4451898","GSM4451899","GSM4451900","GSM4451901","GSM4451903","GSM4451904","GSM4451905","GSM4451906","GSM4451907","GSM4451908","GSM4451909","GSM4451910","GSM4451911","GSM4451912","GSM4451913",
"GSM4451915","GSM4451916","GSM4451917","GSM4451918","GSM4451919","GSM4451920","GSM4451921","GSM4451923","GSM4451924","GSM4451926","GSM4451927","GSM4451928","GSM4451929","GSM4451930","GSM4451931","GSM4451932","GSM4451933","GSM4451934","GSM4451935","GSM4451936","GSM4451937","GSM4451938","GSM4451939","GSM4451940","GSM4451943","GSM4451944","GSM4451945","GSM4451946","GSM4451947","GSM4451948",
"GSM4451949","GSM4451950","GSM4451951","GSM4451952","GSM4451953","GSM4451954","GSM4451955","GSM4451956","GSM4451957","GSM4451958","GSM4451959","GSM4451960","GSM4451961","GSM4451962","GSM4451963","GSM4451964","GSM4451965","GSM4451966","GSM4451967","GSM4451968","GSM4451969","GSM4451970","GSM4451971","GSM4451972","GSM4451973","GSM4451974","GSM4451976","GSM4451977","GSM4451978","GSM4451979",
"GSM4451980","GSM4451981","GSM4451982","GSM4451983","GSM4451984","GSM4451985","GSM4451987","GSM4451988","GSM4451989","GSM4451990","GSM4451991","GSM4451992","GSM4451993","GSM4451994","GSM4451995","GSM4451997","GSM4451998","GSM4451999","GSM4452000","GSM4452001","GSM4452003","GSM4452005","GSM4452007","GSM4452008","GSM4452009","GSM4452010","GSM4452012","GSM4452015","GSM4452016","GSM4452017",
"GSM4452018","GSM4452019","GSM4452020","GSM4452022","GSM4452023","GSM4452025","GSM4452026","GSM4452027","GSM4452028","GSM4452029","GSM4452030","GSM4452031","GSM4452032","GSM4452033","GSM4452035","GSM4452036","GSM4452037","GSM4452038","GSM4452039","GSM4478957","GSM4478958","GSM4478959","GSM4478960","GSM4478961","GSM4478962","GSM4589988","GSM4589989","GSM4589990","GSM4589992","GSM4794800",
"GSM4794801","GSM4794802","GSM4794803","GSM4794804","GSM4794805","GSM4794806","GSM4794807","GSM4794808","GSM4794809","GSM4794810","GSM4794811","GSM4794812","GSM4794813","GSM4794814","GSM4794816","GSM4794817","GSM4794818","GSM4794819","GSM4794820","GSM4794821","GSM4794822","GSM4794823","GSM4794824","GSM4794825","GSM4794826","GSM4794827","GSM4801029","GSM4801030","GSM4801031","GSM4801032",
"GSM4801033","GSM4801034","GSM4801035","GSM4801036","GSM4801037","GSM4801038","GSM4801039","GSM4801040","GSM4801041","GSM4801042","GSM4801043","GSM4801044","GSM4820771","GSM4820772","GSM4973682","GSM4973683","GSM4973684","GSM4973685","GSM4973687","GSM4973688","GSM4973689","GSM4973691","GSM4973693","GSM4973694","GSM4973695","GSM4973696","GSM4973697","GSM4973698","GSM4973700","GSM4973701",
"GSM4973702","GSM4973703","GSM4973704","GSM4973705","GSM4973706","GSM4973707","GSM4973708","GSM4973710","GSM4973711","GSM4973712","GSM4973714","GSM4973717","GSM4973718","GSM4973719","GSM4973720","GSM4973721","GSM4973724","GSM4973726","GSM4973727","GSM4973730","GSM4973731","GSM4973732","GSM4973733","GSM4973734","GSM4973736","GSM4973737","GSM4973738","GSM4973739","GSM4973740","GSM4973741",
"GSM4973743","GSM4973744","GSM4973745","GSM5032027","GSM5032029","GSM5032030","GSM5032032","GSM5032033","GSM5032036","GSM5032039","GSM5032040","GSM5032042","GSM5032046","GSM5048887","GSM5048890","GSM5048891","GSM5048892","GSM5048895","GSM5048897","GSM5048899","GSM5048900","GSM5048901","GSM5048902","GSM5048903","GSM5048904","GSM5048905","GSM5048906","GSM5048907","GSM5048908","GSM5048909",
"GSM5048910","GSM5048911","GSM5048912","GSM5048913","GSM5048915","GSM5048916","GSM5048917","GSM5048918","GSM5048919","GSM5048920","GSM5048923","GSM5048924","GSM5048925","GSM5048926","GSM5048927","GSM5048928","GSM5048929","GSM5048930","GSM5048932","GSM5048933","GSM5048934","GSM5048936","GSM5071084","GSM5071085","GSM5071086","GSM5071087","GSM5071088","GSM5071089","GSM5071090","GSM5071092",
"GSM5071094","GSM5071095","GSM5071097","GSM5071098","GSM5071099","GSM5071100","GSM5071101","GSM5071102","GSM5071103","GSM5071104","GSM5071105","GSM5071106","GSM5071107","GSM5071108","GSM5071109","GSM5071110","GSM5071111","GSM5071112","GSM5071113","GSM5071114","GSM5071115","GSM5071116","GSM5071117","GSM5071118","GSM5071119","GSM5141321","GSM5172217","GSM5332644","GSM5332646","GSM5542361",
"GSM5552176","GSM5552178","GSM5552181","GSM5552183","GSM5552185","GSM5552187","GSM5552189","GSM5552191","GSM5552192","GSM5552194","")

# Retrieve information from compressed data
samples = h5read(destination_file, "meta/samples/geo_accession")
genes = h5read(destination_file, "meta/genes/genes")

# Identify columns to be extracted
sample_locations = which(samples %in% samp)

# extract gene expression from compressed data
expression = t(h5read(destination_file, "data/expression", index=list(sample_locations, 1:length(genes))))
H5close()
rownames(expression) = genes
colnames(expression) = samples[sample_locations]

# Print file
write.table(expression, file=extracted_expression_file, sep="\t", quote=FALSE, col.names=NA)
print(paste0("Expression file was created at ", getwd(), "/", extracted_expression_file))

