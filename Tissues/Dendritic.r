# R script to download selected samples
# Copy code and run on a local machine to initiate download

library("rhdf5")    # can be installed using Bioconductor

destination_file = "human_matrix_v10.h5"
extracted_expression_file = "Dendritic_expression_matrix.tsv"
url = "https://s3.amazonaws.com/mssm-seq-matrix/human_matrix_v10.h5"

# Check if gene expression file was already downloaded, if not in current directory download file form repository
if(!file.exists(destination_file)){
    print("Downloading compressed gene expression matrix.")
    download.file(url, destination_file, quiet = FALSE, mode = 'wb')
}

# Selected samples to be extracted
samp = c("GSM1556295","GSM1565956","GSM1565966","GSM1565960","GSM2090439","GSM1565963","GSM2090443","GSM2090448","GSM1565965","GSM1565962","GSM1640152","GSM1565998","GSM1640154","GSM1565958","GSM1565955","GSM1565959","GSM2090447","GSM1565957","GSM1566002","GSM1566000","GSM2090440","GSM1565997","GSM2090433","GSM2090442","GSM2090437","GSM2090435","GSM1566001","GSM1565964","GSM1565961","GSM2090441","GSM2090434",
"GSM2090445","GSM2090432","GSM1640156","GSM2090444","GSM2090446","GSM2090436","GSM1640155","GSM1565999","GSM1640153","GSM2090438","GSM2361538","GSM2361552","GSM2361537","GSM2361539","GSM2361553","GSM2361555","GSM2361554","GSM2361551","GSM2361598","GSM2361648","GSM2361556","GSM2361601","GSM2361640","GSM2361535","GSM2361561","GSM2361647","GSM2361639","GSM2361557","GSM2361636","GSM2361524",
"GSM2361558","GSM2361644","GSM2361637","GSM2361588","GSM2361525","GSM2361589","GSM2361550","GSM2361641","GSM2361545","GSM2361590","GSM2361587","GSM2361529","GSM2361646","GSM2361593","GSM2361559","GSM2361596","GSM2361547","GSM2361595","GSM2361528","GSM2361633","GSM2361548","GSM2361623","GSM2361584","GSM2361527","GSM2361542","GSM2361532","GSM2361632","GSM2361546","GSM2361526","GSM2361543",
"GSM2361569","GSM2361565","GSM2361530","GSM2361631","GSM2361541","GSM2361580","GSM2361531","GSM2361630","GSM2361608","GSM2361627","GSM2361578","GSM2361534","GSM2361574","GSM2361599","GSM2361597","GSM2361605","GSM2361611","GSM2361562","GSM2361560","GSM2361579","GSM2361615","GSM2361606","GSM2361521","GSM2361628","GSM2361568","GSM2361522","GSM2361616","GSM2361566","GSM2361572","GSM2361619",
"GSM2361621","GSM2361622","GSM2361517","GSM2361520","GSM2361519","GSM2361514","GSM2361610","GSM2361613","GSM2361510","GSM2361511","GSM2361518","GSM2361607","GSM2361513","GSM2361516","GSM2361506","GSM2361512","GSM2361504","GSM2361509","GSM2027310","GSM2027316","GSM2027314","GSM2027311","GSM2027321","GSM2027318","GSM2027320","GSM2027317","GSM2027313","GSM2027315","GSM2027319","GSM2027312",
"GSM2055642","GSM2055645","GSM2055643","GSM2055641","GSM2055644","GSM2055640","GSM2360280","GSM2360281","GSM2360282","GSM2358595","GSM2358596","GSM2358597","GSM2358598","GSM2358599","GSM2358600","GSM2358601","GSM2358602","GSM2471231","GSM2471234","GSM2471240","GSM2471242","GSM2471261","GSM2471262","GSM2471264","GSM2471267","GSM2471270","GSM2471278","GSM2471279","GSM2471281","GSM2471284",
"GSM2471291","GSM2471295","GSM2471304","GSM2228986","GSM2228987","GSM2228988","GSM2228989","GSM2228990","GSM2228991","GSM2228992","GSM2228993","GSM2228994","GSM2228995","GSM2228996","GSM2228997","GSM2228998","GSM2228999","GSM2229000","GSM2471248","GSM2471252","GSM2471282","GSM2471292","GSM2717603","GSM2717605","GSM2717607","GSM2717608","GSM2717613","GSM2717615","GSM2717616","GSM2717617",
"GSM2717618","GSM2717619","GSM2717620","GSM2717621","GSM2717622","GSM2717623","GSM2717624","GSM2717625","GSM2717626","GSM2717627","GSM2717628","GSM2898233","GSM2898234","GSM2898235","GSM2898236","GSM2898237","GSM2898238","GSM2898239","GSM2898240","GSM2898364","GSM2898365","GSM2898366","GSM2898367","GSM2898368","GSM2898369","GSM2898370","GSM2898371","GSM2898372","GSM2898373","GSM2898374",
"GSM2898375","GSM2898376","GSM2898377","GSM2898378","GSM2898379","GSM2898380","GSM2902781","GSM2902782","GSM2902783","GSM2902784","GSM2902785","GSM2902786","GSM2902787","GSM2902788","GSM2902789","GSM2902790","GSM2902791","GSM2902792","GSM2902793","GSM2902794","GSM2902795","GSM2902796","GSM2902797","GSM2902798","GSM2902799","GSM2902800","GSM2902801","GSM2902802","GSM2902803","GSM2902804",
"GSM2902805","GSM2902806","GSM2902807","GSM2902808","GSM2902809","GSM2902810","GSM2469538","GSM2469539","GSM2469540","GSM2469541","GSM2469542","GSM2469543","GSM2469544","GSM2469545","GSM2469546","GSM2469547","GSM2469548","GSM2469549","GSM2469550","GSM2469551","GSM2469552","GSM2469553","GSM2469554","GSM2469555","GSM2469556","GSM2469557","GSM2469558","GSM2469559","GSM2469560","GSM2469561",
"GSM2469562","GSM2469563","GSM2469564","GSM2469565","GSM2469566","GSM2469567","GSM2469568","GSM2469569","GSM2469570","GSM2469571","GSM2469572","GSM2469573","GSM2469574","GSM2469575","GSM2469576","GSM2469577","GSM2469578","GSM2469579","GSM2469580","GSM2469581","GSM2469582","GSM2469583","GSM2469584","GSM2469585","GSM2469586","GSM2469587","GSM3162630","GSM3162632","GSM2536296","GSM2536297",
"GSM2536298","GSM2536299","GSM2536300","GSM2536301","GSM2536302","GSM2536303","GSM2536304","GSM2536305","GSM2536306","GSM2536307","GSM2536308","GSM2536309","GSM2536310","GSM2536311","GSM2536312","GSM2536313","GSM2536314","GSM2536315","GSM3192743","GSM3231104","GSM3231105","GSM3231112","GSM3231114","GSM3231117","GSM3231127","GSM3231145","GSM2904778","GSM2904779","GSM2904797","GSM2904798",
"GSM2904804","GSM2904838","GSM2904846","GSM3177889","GSM3177890","GSM3177891","GSM3177892","GSM3177893","GSM3177894","GSM3177895","GSM3032979","GSM3032980","GSM3032981","GSM3032982","GSM3032983","GSM3032984","GSM3032985","GSM3032986","GSM3032987","GSM3032988","GSM3032989","GSM3032990","GSM3032991","GSM3032992","GSM3032993","GSM3032994","GSM3032995","GSM3032996","GSM3032998","GSM3032999",
"GSM3033000","GSM3033001","GSM3033002","GSM3033003","GSM3033004","GSM3033005","GSM3033006","GSM3033007","GSM3033008","GSM3033009","GSM3033010","GSM3033011","GSM3033012","GSM3033013","GSM3033014","GSM3033015","GSM3033016","GSM3033017","GSM3033018","GSM3033019","GSM3033020","GSM3033021","GSM3033022","GSM3033023","GSM3033024","GSM3033025","GSM3033026","GSM3033027","GSM3033028","GSM3033029",
"GSM3033030","GSM3033031","GSM3033032","GSM3033033","GSM3033034","GSM3033035","GSM3033036","GSM3033037","GSM3033038","GSM3033039","GSM3033040","GSM3033041","GSM3033042","GSM3033043","GSM3033044","GSM3033045","GSM3033046","GSM3033047","GSM3033048","GSM3033049","GSM3033050","GSM3033051","GSM3033052","GSM3033053","GSM3033054","GSM3033055","GSM3033056","GSM3033057","GSM3033058","GSM3033059",
"GSM3033060","GSM3033061","GSM3033062","GSM3033063","GSM3033064","GSM3033065","GSM3033066","GSM3033067","GSM3033068","GSM3033069","GSM3033070","GSM3033071","GSM3033072","GSM3033073","GSM3033075","GSM3033076","GSM3033077","GSM3033078","GSM3033079","GSM3033080","GSM3033081","GSM3033082","GSM3033083","GSM3033084","GSM3033085","GSM3033086","GSM3033087","GSM3033088","GSM3033089","GSM3033090",
"GSM3033091","GSM3033092","GSM3033093","GSM3033094","GSM3033095","GSM3033096","GSM3033097","GSM3033098","GSM3033099","GSM3033100","GSM3033101","GSM3033102","GSM3033103","GSM3033104","GSM3033105","GSM3033106","GSM3033107","GSM3033108","GSM3033109","GSM3033110","GSM3033111","GSM3033112","GSM3033113","GSM3033114","GSM3033115","GSM3033116","GSM3033117","GSM3033118","GSM3033119","GSM3033120",
"GSM3033121","GSM3033122","GSM3033123","GSM3033124","GSM3033125","GSM3033126","GSM3033127","GSM3033128","GSM3033129","GSM3033130","GSM3033131","GSM3033132","GSM3033133","GSM3033134","GSM3033135","GSM3033136","GSM3033137","GSM3033138","GSM3033139","GSM3033140","GSM3033141","GSM3033143","GSM3033144","GSM3033145","GSM3033146","GSM3033147","GSM3033148","GSM3033149","GSM3033150","GSM3033151",
"GSM3033152","GSM3033153","GSM3033154","GSM3033155","GSM3033156","GSM3033157","GSM3033158","GSM3033159","GSM3033160","GSM3033161","GSM3033162","GSM3033163","GSM3033164","GSM3033165","GSM3033166","GSM3033167","GSM3033168","GSM3033169","GSM3033170","GSM3033171","GSM3033172","GSM3033173","GSM3033174","GSM3033175","GSM3033176","GSM3033177","GSM3033178","GSM3033179","GSM3033180","GSM3033181",
"GSM3033182","GSM3033183","GSM3033184","GSM3033185","GSM3033186","GSM3033187","GSM3033188","GSM3033189","GSM3033190","GSM3033191","GSM3033192","GSM3033193","GSM3033194","GSM3033195","GSM3033196","GSM3033197","GSM3033198","GSM3033199","GSM3033200","GSM3033201","GSM3033202","GSM3033203","GSM3033204","GSM3033205","GSM3033206","GSM3033207","GSM3033208","GSM3033209","GSM3033210","GSM3033211",
"GSM3033212","GSM3033213","GSM3033214","GSM3033215","GSM3033216","GSM3033217","GSM3033218","GSM3033219","GSM3033220","GSM3033221","GSM3033222","GSM3033223","GSM3033224","GSM3033225","GSM3033226","GSM3033227","GSM3033228","GSM3033229","GSM3033230","GSM3033231","GSM3033232","GSM3033233","GSM3033234","GSM3033235","GSM3033236","GSM3033237","GSM3033238","GSM3033239","GSM3033240","GSM3033241",
"GSM3033242","GSM3033243","GSM3033244","GSM3033245","GSM3033246","GSM3033247","GSM3033248","GSM3033249","GSM3033250","GSM3033251","GSM3033252","GSM3033253","GSM3033254","GSM3033255","GSM3033256","GSM3033257","GSM3033258","GSM3033259","GSM3033260","GSM3033261","GSM3033262","GSM3033263","GSM3033264","GSM3033265","GSM3033267","GSM3033268","GSM3033269","GSM3033270","GSM3033271","GSM3033272",
"GSM3033273","GSM3033274","GSM3033275","GSM3033276","GSM3033277","GSM3033278","GSM3033279","GSM3033280","GSM3033281","GSM3033282","GSM3033283","GSM3033284","GSM3033285","GSM3033286","GSM3033287","GSM3033288","GSM3033289","GSM3033290","GSM3033291","GSM3033292","GSM3033293","GSM3033294","GSM3033295","GSM3033296","GSM3033297","GSM3033298","GSM3033299","GSM3033300","GSM3033301","GSM3033302",
"GSM3033303","GSM3033304","GSM3033305","GSM3033306","GSM3033307","GSM3033308","GSM3033309","GSM3033310","GSM3033311","GSM3033312","GSM3033313","GSM3033314","GSM3033315","GSM3033316","GSM3033317","GSM3033318","GSM3033319","GSM3033320","GSM3033321","GSM3033322","GSM3033323","GSM3033324","GSM3033325","GSM3033326","GSM3033327","GSM3033328","GSM3033329","GSM3033330","GSM3033331","GSM3033332",
"GSM3033333","GSM3033334","GSM3033335","GSM3033336","GSM3033337","GSM3033338","GSM3033339","GSM3033340","GSM3033341","GSM3033342","GSM3033343","GSM3033344","GSM3033345","GSM3033346","GSM3033347","GSM3033348","GSM3033349","GSM3033350","GSM3033351","GSM3033352","GSM3033353","GSM3033354","GSM3033355","GSM3033356","GSM3033357","GSM3033358","GSM3033359","GSM3033360","GSM3033361","GSM3033362",
"GSM3033377","GSM3033378","GSM3033379","GSM3033380","GSM3033381","GSM3033382","GSM3033383","GSM3033384","GSM3033385","GSM3033386","GSM3033387","GSM3033388","GSM3033389","GSM3033390","GSM3033391","GSM3033392","GSM3033393","GSM3033394","GSM3033395","GSM3033396","GSM3033397","GSM3033398","GSM3033399","GSM3033400","GSM3033401","GSM3033402","GSM3033403","GSM3033404","GSM3033405","GSM3033406",
"GSM3033407","GSM3033408","GSM3033409","GSM3033410","GSM3033411","GSM3033412","GSM3033413","GSM3033414","GSM3033415","GSM3033416","GSM3033417","GSM3033418","GSM3033419","GSM3033420","GSM3033421","GSM2357501","GSM2357503","GSM2357505","GSM2357506","GSM2357507","GSM2357509","GSM2357514","GSM2357518","GSM2859435","GSM2859436","GSM2859464","GSM2859465","GSM2859493","GSM2859494","GSM2859527",
"GSM2859528","GSM3506319","GSM3506320","GSM3506321","GSM3506322","GSM3506331","GSM3506332","GSM3506333","GSM3874730","GSM3874731","GSM3874732","GSM3874733","GSM3874734","GSM3874735","GSM3874736","GSM3874737","GSM3874738","GSM3874739","GSM3874741","GSM3874742","GSM3874743","GSM3874744","GSM3874745","GSM3874746","GSM3874747","GSM3874748","GSM3874749","GSM3874750","GSM3874751","GSM3874752",
"GSM3874753","GSM3874754","GSM3874755","GSM3874756","GSM3874757","GSM3874758","GSM3874759","GSM3874760","GSM3874761","GSM3874762","GSM3874763","GSM3874764","GSM3874765","GSM3874766","GSM3874767","GSM3874768","GSM3874769","GSM3874770","GSM3874771","GSM3874772","GSM3874773","GSM3874774","GSM3874775","GSM3874776","GSM3874777","GSM3874778","GSM3874779","GSM3874780","GSM3874781","GSM3874782",
"GSM3874783","GSM3874784","GSM3874785","GSM3874786","GSM3874787","GSM3874788","GSM3874789","GSM3874790","GSM3874791","GSM3874792","GSM3874793","GSM3874794","GSM3874795","GSM3874796","GSM3874797","GSM3874798","GSM3874799","GSM3874800","GSM3874801","GSM3874802","GSM3874803","GSM3874804","GSM3874805","GSM3874806","GSM3874807","GSM3874808","GSM3874809","GSM3874810","GSM3874811","GSM3874812",
"GSM3874813","GSM3874814","GSM3874815","GSM3874816","GSM3874817","GSM3874818","GSM3874819","GSM3874820","GSM3874821","GSM3874822","GSM3874823","GSM3874824","GSM3874825","GSM3874826","GSM3874827","GSM3874828","GSM3874829","GSM3874830","GSM3874831","GSM3874832","GSM3874833","GSM3874834","GSM3874835","GSM3874836","GSM3874837","GSM3874838","GSM3874839","GSM3874840","GSM3874841","GSM3874842",
"GSM3874843","GSM3874844","GSM3874845","GSM3874846","GSM3874847","GSM3874848","GSM3874849","GSM3874850","GSM3874851","GSM3874852","GSM3874853","GSM3874854","GSM3874855","GSM3874856","GSM3874857","GSM3874858","GSM3874859","GSM3874860","GSM3874861","GSM3874862","GSM3874863","GSM3874864","GSM3874865","GSM3874866","GSM3874867","GSM3874868","GSM3874869","GSM3874870","GSM3874871","GSM3874872",
"GSM3874873","GSM3874874","GSM3874875","GSM3874876","GSM3874877","GSM3874878","GSM3874879","GSM3874880","GSM3874881","GSM3874882","GSM3874883","GSM3874884","GSM3874885","GSM3874886","GSM3874887","GSM3874888","GSM3874889","GSM3874890","GSM3874891","GSM3874892","GSM3874893","GSM3874894","GSM3874895","GSM3874896","GSM3874897","GSM3874898","GSM3874899","GSM3874900","GSM3874901","GSM3874902",
"GSM3874903","GSM3874904","GSM3874905","GSM3874906","GSM3874907","GSM3874908","GSM3874909","GSM3874910","GSM3874911","GSM3874912","GSM3874913","GSM3874914","GSM3874915","GSM3874916","GSM3874917","GSM3874918","GSM3874919","GSM3874920","GSM3874921","GSM3874922","GSM3874923","GSM3874924","GSM3874925","GSM3874926","GSM3874927","GSM3874928","GSM3874929","GSM3874930","GSM3874931","GSM3874932",
"GSM3874933","GSM3874934","GSM3874935","GSM3874936","GSM3874937","GSM3874938","GSM3874939","GSM3874940","GSM3874941","GSM3874942","GSM3874943","GSM3874944","GSM3874945","GSM3874946","GSM3874947","GSM3874948","GSM3874949","GSM3874950","GSM4024061","GSM4024062","GSM4024063","GSM4024064","GSM4024065","GSM4024066","GSM4024067","GSM4024068","GSM4024069","GSM4024070","GSM4024071","GSM4024072",
"GSM4024073","GSM4024074","GSM4024075","GSM4024076","GSM4024077","GSM4024078","GSM4024079","GSM4024080","GSM4024081","GSM4024082","GSM4024083","GSM4024084","GSM4024085","GSM4024086","GSM4024087","GSM4024088","GSM4024089","GSM4024090","GSM4024091","GSM2366135","GSM2366140","GSM2366141","GSM4024030","GSM4024031","GSM4024032","GSM4024033","GSM4024034","GSM4024035","GSM4024036","GSM4024037",
"GSM4024038","GSM4024039","GSM4024040","GSM4024041","GSM4024042","GSM4024043","GSM4024044","GSM4024045","GSM4024046","GSM4024047","GSM4024048","GSM4024049","GSM4024050","GSM4024051","GSM4024052","GSM4024053","GSM4024054","GSM4024055","GSM4024056","GSM4024057","GSM4024058","GSM4024059","GSM4024060","GSM4272812","GSM4272813","GSM4272814","GSM4272815","GSM4272816","GSM4272817","GSM4272818",
"GSM4272819","GSM4272820","GSM4272821","GSM4272822","GSM4272823","GSM4272824","GSM4272825","GSM4272826","GSM4272827","GSM4272828","GSM4272829","GSM3942656","GSM3942666","GSM3942676","GSM3942686","GSM4010368","GSM4010372","GSM4010376","GSM4042696","GSM4042698","GSM4042700","GSM4367881","GSM4367882","GSM4367883","GSM4367884","GSM4367885","GSM4367886","GSM4367888","GSM4367889","GSM4367890",
"GSM4367891","GSM4367892","GSM4367893","GSM4367894","GSM4367895","GSM4776601","GSM4776602","GSM4776603","GSM4776604","GSM1714212","GSM1714213","GSM1714214","GSM1714215","GSM1714216","GSM1714217","GSM1714218","GSM1714219","GSM3028618","GSM3028620","GSM3028622","GSM3028623","GSM3028625","GSM3028626","GSM3028627","GSM3028628","GSM3028629","GSM3028641","GSM3028642","GSM3028643","GSM3028648",
"GSM3028650","GSM4117485","GSM4117486","GSM4117487","GSM4117488","GSM4117490","GSM4425580","GSM4425581","GSM4425582","GSM4425584","GSM4425585","GSM4425599","GSM4425600","GSM4425611","GSM4425612","GSM4425613","GSM4425614","GSM4425625","GSM4425626","GSM4425627","GSM4425628","GSM4425639","GSM4425641","GSM4425642","GSM4425653","GSM4425654","GSM4425655","GSM4425656","GSM4647991","GSM4647992",
"GSM4647994","GSM4647996","GSM4647998","GSM4647999","GSM4648002","GSM4648005","GSM4648006","GSM4648008","GSM4648009","GSM4648011","GSM4648014","GSM4648015","GSM4648019","GSM4648020","GSM4648036","GSM4648037","GSM4648039","GSM4648040","GSM4648041","GSM4648042","GSM4648043","GSM4648047","GSM4648048","GSM4648050","GSM4648052","GSM4648053","GSM4648058","GSM4648059","GSM4648064","GSM4648065",
"GSM4648070","GSM4648071","GSM4648073","GSM4648074","GSM4715389","GSM4715390","GSM4715391","GSM4715392","GSM4715393","GSM4715394","GSM4715396","GSM4715397","GSM4715398","GSM4715403","GSM4816930","GSM4816931","GSM4816935","GSM4816938","GSM4816939","GSM4820313","GSM4820314","GSM4820315","GSM4820316","GSM4820317","GSM4820318","GSM4820319","GSM4820320","GSM4820321","GSM4820322","GSM4820323",
"GSM4820324","GSM4906530","GSM4906531","GSM4906532","GSM4906533","GSM4906534","GSM4906535","GSM4906536","GSM4906538","GSM4906539","GSM4906540","GSM4906541","GSM4906542","GSM4906543","GSM4906544","GSM4906545","GSM4906546","GSM4906547","GSM4906548","GSM4906549","GSM4906550","GSM4906551","GSM4906552","GSM4906554","GSM4906555","GSM4906556","GSM4906557","GSM4906559","GSM4907539","GSM4907540",
"GSM4907541","GSM4907542","GSM4907543","GSM4907544","GSM4907545","GSM4907546","GSM4907547","GSM4907548","GSM4907549","GSM4907550","GSM4907551","GSM4907552","GSM4907553","GSM4907554","GSM4907555","GSM4907556","GSM4907557","GSM4907558","GSM4907559","GSM4907560","GSM4907561","GSM4907562","GSM4907563","GSM4907564","GSM4907565","GSM4907566","GSM4907567","GSM4907568","GSM4907569","GSM4907570",
"GSM4907571","GSM4907572","GSM4907573","GSM4907574","GSM4907575","GSM4907576","GSM4907577","GSM4907578","GSM4907579","GSM4907580","GSM4907581","GSM4907582","GSM4907583","GSM4907584","GSM4907585","GSM5057684","GSM5057685","GSM5057686","GSM5057687","GSM5057688","GSM5057690","GSM5057691","GSM5057694","GSM5057791","GSM5057792","GSM5057793","GSM5057794","GSM5057795","GSM5057796","GSM5057797",
"GSM5057798","GSM5057802","GSM5057803","GSM5057804","GSM5057805","GSM5107594","GSM5107595","GSM5107596","GSM5107597","GSM5107598","GSM5107599","GSM5107600","GSM5107601","GSM5107602","GSM5107603","GSM5283160","GSM5283161","GSM5283162","GSM5283164","GSM5283165","")

# Retrieve information from compressed data
samples = h5read(destination_file, "meta/samples/geo_accession")
genes = h5read(destination_file, "meta/genes/genes")

# Identify columns to be extracted
sample_locations = which(samples %in% samp)

# extract gene expression from compressed data
expression = t(h5read(destination_file, "data/expression", index=list(sample_locations, 1:length(genes))))
H5close()
rownames(expression) = genes
colnames(expression) = samples[sample_locations]

# Print file
write.table(expression, file=extracted_expression_file, sep="\t", quote=FALSE, col.names=NA)
print(paste0("Expression file was created at ", getwd(), "/", extracted_expression_file))

